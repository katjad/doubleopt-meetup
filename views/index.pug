extends layout

block content
  h1= title
  if user
    p Currently logged in as: #{user.name} (Meetup id: #{user.id})     
  if user
    a(href="/logout") Logout
  else 
    a(href="/auth/meetup") Login via Meetup
  p 

  table
      tr 
        td Name
        td Attending
        td Python Dojo
      if jsondata
        each member in jsondata
          if user
            - var className = (member.id == user.id) ? 'active' : ''
          tr(id=member.id) 
            td(class=className) #{member.name}
            td              
              if className == 'active'
                input(
                  type='checkbox'
                  name='confirmation'
                  checked=(member.confirmed)                                 
                )
              else
                - var conf = (member.confirmed) ? 'Yes' : 'No'
                span #{conf}
            td
              if className == 'active'
                form(action="/")
                  mixin tabledata(name, id, value)
                    input(
                      type='radio' 
                      name='preference' 
                      id=id 
                      value=value
                      checked=(member.preference == value)                   
                    )
                    label(for=id) #{name}
                  +tabledata('Hacknight', 'toggle-hn', 'Hacknight')
                  +tabledata('Python Dojo', 'toggle-python', 'Python')
                  +tabledata('Haskell', 'toggle-haskell', 'Haskell')
                  br
                  button(type="submit" id="submitconf") Submit
                  br
                  span(id="message")
              else 
                  span #{member.preference}        
      else 
        p Cannot retrieve data at this point
block scripts 
  if jsondata 
    script
      | var myjson = !{jsonmod}
  if user
    script
      | window.userId = #{user.id};      
  script(src="/javascripts/postdata.js")
